# Reciprocity under conflict: Replication Materials

Thank you for your interest in our study on reciprocity under conflict. This repository provides all the materials necessary to replicate our study.

**Please note that this repository is still under construction. We are working on the documentation and scripts to make it easier to reproduce our results.**

## Contents

The repository contains the following items:

- `code/simulation`: This directory contains the simulation code implemented in Python 3.
- `code/analysis`: This directory contains the code for the analysis and plots written in R.
- `output/`: This directory will contain the output for the simulation (data). 
- `plots/`: This directory will contain the plots generated by R.

## Data

There are two ways to reproduce the results of our study:

**1. Simuate the study on your machine**

You can reproduce our results by running the simulation code on your machine. Note that running the simulation code with every possible parameter combination may take a considerable amount of time. (Several days on a standard machine with 8 cores). 

**2. Use Our Precomputed Data**

We also provide the precomputed data that we used in our study, which you can download from the following link (805 MB in total): https://www.dropbox.com/sh/zu6czzbl1jiscmq/AACE0-A3NiDN2Q98zk9R6QQ9a?dl=0

## Instructions to Reproduce

To reproduce the analysis and plots presented in our study, you need to run the R scripts provided in the `code/` directory. These scripts use the data generated by the simulation code or the precomputed data, depending on the option you choose.

Note that you will need to install the necessary R packages listed in the `code/requirements.R` file before running the analysis scripts. 

The resulting plots and analysis will be saved in the `plots/` directory.

### Reproducing using our pre-simulated data
1- Clone the repository 
```
git clone https://github.com/aseyq/reciprocity_under_conflict.git
```

2- Download `.parquet` files from the Dropbox link (805 MB)
https://www.dropbox.com/sh/zu6czzbl1jiscmq/AACE0-A3NiDN2Q98zk9R6QQ9a?dl=0

3- Extract the `.parquet` files (`df_aggregate_payoffs.parquet`, `df_coop.parquet`, `df_long.parquet` in the folder `output/processeddata`

4- Install the required R packages if necessary
```
cd reciprocity_under_conflict
cd code/analysis
RScript requirements.R
```
5- Run the following scripts
  - Plots in the paper: `paper_plots.R`
  - SI: `si_plots.R`, `si_basefit.R`, `si_moran.R`

### Reproducing by running the simulations
1- Clone the repository 
```
git clone https://github.com/aseyq/reciprocity_under_conflict.git
```
2- Go to downloaded folder
```
cd reciprocity_under_conflict
```
3- (Optional but recommended) Create a Python virtual environment,
```
python3 -m venv venv
```
and activate it

(MacOS and Ubuntu)
```
source venv/bin/activate
```

(Windows)
```
venv\Scripts\activate
```
4- Install required packages

```
cd code/simulation
pip install -r requirements.txt
```

5- Run simulations 
Please note that might take long time even with the default reduced number of parameters. The paper uses 1000 generations and 1000 iterations while the reproduction code has 500 generations and 10 iterations. You can change it by modifying line 23 and 23 in `simulate.py`
```
python3 simulate.py
```

6- Combine CSV files created by the simulation

```
cd code/analysis
Rscript 1_combine_csvs.R
```

7- Convert CSV files to a parquet file
```
Rscript 2_convert_parquet.R
```

8- Reshape data into long format and generate additional tables
```
Rscript 3_reshape_data.R
```

After these steps, you should have the processed data stored in `output/processeddata`. Then you can run the scripts to regenerate the analyses in the paper.

9- Execute the following scripts
  - Plots in the paper: `paper_plots.R`
  - SI: `si_plots.R`, `si_basefit.R`, `si_moran.R`


## Citation

If you use our materials for your own research, please cite our original paper using the following reference:

[TBA] 


